<!doctype html>
<html lang="es" data-theme="cream">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Búsqueda</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
   :root{
      --bd:#e6e8eb;
      --muted:#6b7280;
      --bg:#f8fafc;
      --text:#0f172a;
      --primary:#2563eb;
      --primary-contrast:#ffffff;
      --soft-bg:#f1f5f9;
      --soft-hover:#e9eef5;
      --outline:#cbd5f5;
    }
    [data-theme="cream"]{
      --bd:#d5c1b1;
      --muted:#6d5d52;
      --bg:#edddce;
      --surface:#ffffff;
      --text:#2c1d1f;
      --primary:#4b2743;
      --primary-contrast:#fdf6f2;
      --soft-hover:#d6c2b2;
      --outline:#4b2743;
    }
    [data-theme="white"]{
      --bd:#e6e8eb;
      --muted:#6b7280;
      --bg:#f8fafc;
      --surface:#ffffff;
      --text:#0f172a;
      --primary:#2563eb;
      --primary-contrast:#ffffff;
      --soft-bg:#f1f5f9;
      --soft-hover:#e9eef5;
      --outline:#cbd5f5;
    }
    body{ background:var(--bg); color:var(--text); }
  .topbar{ background:#ffffff; border-bottom:1px solid var(--bd); position:sticky; top:0; z-index:10; }
    .topbar-inner{ position:relative; min-height:44px; }    
    .sitewrap{ max-width: 1280px; }
    .panel{ background:var(--surface); border:1px solid var(--bd); border-radius:12px; }
    .panel-header{ border-bottom:1px solid var(--bd); padding:.75rem 1rem; font-weight:600; }
    .panel-body{ padding:1rem; background:var(--surface); }
    .btn-soft{ background:var(--soft-bg); border:1px solid var(--bd); color:var(--text); }
    .btn-soft:hover{ background:var(--soft-hover); }
     .result-toggle-btn{
      background:#4b2743;
      border-color:#4b2743;
      color:#ffffff;
    }
    .result-toggle-btn:hover{
      background:#5e3254;
      border-color:#5e3254;
      color:#ffffff;
    }
    .result-toggle-btn.is-open,
    .result-toggle-btn.is-open:hover{
      background:#1f121c;
      border-color:#1f121c;
      color:#ffffff;
    }
    .tag{ display:inline-flex; align-items:center; gap:.35rem; padding:.15rem .6rem; border-radius:999px; font-size:.8rem; background:var(--soft-bg); color:var(--text); border:1px solid var(--bd); }
    
    .muted{ color: var(--muted); }
    
.search-row{ display:grid; grid-template-columns:minmax(0, 1fr); gap:.65rem; align-items:stretch; }
     .search-column{ display:flex; flex-direction:column; min-width:0; }
    .loading-indicator{ display:inline-flex; align-items:center; gap:.5rem; font-size:.85rem; color:var(--muted); }
    .loading-indicator .spinner{ width:1rem; height:1rem; border:2px solid #cbd5f5; border-top-color:var(--primary); border-radius:50%; animation:spin .8s linear infinite; }
    .results-loading-stage{ min-height:320px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:.85rem; color:var(--muted); background:color-mix(in srgb, var(--soft-bg) 55%, #ffffff); border:1px dashed var(--bd); border-radius:12px; margin-bottom:1rem; }
    .results-loading-stage .big-spinner{ width:4.5rem; height:4.5rem; border:6px solid color-mix(in srgb, var(--primary) 20%, #ffffff); border-top-color:var(--primary); border-radius:50%; animation:spin .9s linear infinite; }
    .form-control,.form-select{ background:#ffffff; border-color:color-mix(in srgb, var(--text) 55%, #ffffff); color:var(--text); }
    .btn-primary{ background:var(--primary); border-color:var(--primary); color:var(--primary-contrast); }
    .btn-outline-primary{ color:var(--primary); border-color:var(--primary); }
[data-theme="cream"] .btn-primary,
    [data-theme="cream"] .btn-outline-primary{
      background:#4b2743;
      border-color:#4b2743;
      color:#ffffff;
    }
    [data-theme="cream"] .btn-primary:hover,
    [data-theme="cream"] .btn-outline-primary:hover{
      background:#ffffff;
      border-color:#4b2743;
      color:#000000;
    }
    [data-theme="cream"] .panel-header{ border-bottom:1px solid #7c4f2b; }
    [data-theme="cream"] .panel-body{ background:#ffffff; color:#000000; }
    [data-theme="cream"] .panel-body .muted{ color:#000000; }
    [data-theme="cream"] .tag,
    [data-theme="cream"] .btn-soft,
    [data-theme="cream"] .results-loading-stage{
      background:#ffffff;
      color:#000000;
      border-color:#4b2743;
    }
    [data-theme="white"] .btn-primary,
    [data-theme="white"] .btn-outline-primary{
      background:#ffffff;
      border-color:#2563eb;
      color:#2563eb;
    }
    [data-theme="white"] .btn-primary:hover,
    [data-theme="white"] .btn-outline-primary:hover{
      background:#eff6ff;
      border-color:#2563eb;
      color:#1d4ed8;
    }
   .search-inline{ width:100%; max-width:820px; margin:0 auto; }
    .book-result-card{ border:1px solid var(--bd); border-radius:10px; padding:.65rem .75rem; background:#fff; }
    .verse-row{ border-top:1px dashed var(--bd); padding-top:.45rem; margin-top:.45rem; }
    .verse-ref{ min-width:120px; font-weight:600; }
    
    @media (min-width: 992px){
      #backToReader{ position:absolute; left:0; top:50%; transform:translateY(-50%); }
    }
    @keyframes spin{ to{ transform:rotate(360deg);} }
  
    .bx-sticky-filters{ position:sticky; top:84px; }
    .bx-filter-group-title{ font-size:.85rem; color:var(--muted); text-transform:uppercase; letter-spacing:.04em; }
    .bx-filter-item{ display:flex; align-items:center; justify-content:space-between; gap:.5rem; width:100%; border:1px solid var(--bd); background:color-mix(in srgb, var(--soft-bg) 70%, #ffffff); padding:.32rem .5rem; border-radius:10px; font-size:.92rem; line-height:1.15; }
    .bx-filter-item:hover{ background:var(--soft-hover); }
    .bx-filter-item.is-active{ outline:2px solid var(--outline); }
    .bx-filter-item .bx-count{ font-size:.85rem; color:var(--muted); }
    .bx-filter-subgroup-title{ font-size:.78rem; color:var(--muted); text-transform:uppercase; letter-spacing:.05em; margin-top:.35rem; margin-bottom:.15rem; padding-left:.25rem; }
.bx-filter-subgroup-title.is-torah{ border-left:3px solid color-mix(in srgb, var(--primary) 55%, #d97706); padding-left:.45rem; }
.bx-filter-subgroup-title.is-gospels{ border-left:3px solid color-mix(in srgb, var(--primary) 55%, #16a34a); padding-left:.45rem; }
.bx-filter-item.bx-book--torah{ border-left:3px solid color-mix(in srgb, var(--primary) 55%, #d97706); }
.bx-filter-item.bx-book--gospels{ border-left:3px solid color-mix(in srgb, var(--primary) 55%, #16a34a); }
.bx-filter-item.bx-testament--ot{ font-weight:650; }
.bx-filter-item.bx-testament--nt{ font-weight:650; }
.bx-filter-item .bx-count{ font-size:.8rem; }
.bx-result-item{ border:1px solid var(--bd); background:color-mix(in srgb, var(--surface) 85%, #ffffff); border-radius:14px; padding:.75rem .85rem; }
    .bx-result-item .bx-ref{ font-weight:700; }
    .bx-result-item .bx-text{ margin-top:.35rem; }
     /* Sidebar más angosta */
  @media (min-width: 1200px){
    .bx-sticky-filters{max-width: 280px;}
  }
    </style>
</head>
<body>
  <header class="topbar">
    <div class="container sitewrap py-2 d-flex flex-wrap gap-2 align-items-center topbar-inner">
      <button id="backToReader" class="btn btn-outline-primary" type="button">← Volver al lector</button>
      <div class="search-inline">
        <div class="input-group">
          <input id="bxQueryInput" class="form-control" placeholder="Ej: אָב, πατήρ, origen, fuente" value=""/>
                    <select id="bxLanguageScope" class="form-select" style="max-width:280px">
            <option value="auto">Idioma detectado</option>
          <option value="es">Español (RVR1960)</option>
            <option value="gr">Griego (LXX + RKANT)</option>
            <option value="he">Hebreo</option>
          <option value="all">Todos los resultados</option>
          </select>
          <button id="bxAnalyzeBtn" class="btn btn-primary" type="button">Buscar</button>
        </div>
      </div>
      </div>
  </header>
    
 <main class="container sitewrap my-3 my-lg-4">

<div id="bxAnalysisResultsSection" class="row g-3">
      <!-- Centro: resultados + paginación -->
<div class="col-12 col-lg-9 col-xl-10">
        <section class="panel">
          <div class="panel-header d-flex flex-wrap justify-content-between align-items-center gap-2">
            <span>Resultados</span>
            <div id="bxResultsLoadingIndicator" class="loading-indicator" role="status" aria-live="polite" hidden>
              <span class="spinner" aria-hidden="true"></span><span>Procesando resultados...</span>
            </div>
          </div>
          <div class="panel-body">
            <div id="bxResultsLoadingStage" class="results-loading-stage" role="status" aria-live="polite" hidden>
              <span class="big-spinner" aria-hidden="true"></span><span class="fw-semibold">Cargando resultados...</span>
            </div>

            <div id="bxResultsList" class="d-grid gap-2"></div>
            <div id="bxResultsByCorpus" class="row g-3" hidden></div>

            <nav class="mt-3" aria-label="Paginación de resultados">
              <ul id="bxPagination" class="pagination pagination-sm mb-0 flex-wrap"></ul>
            </nav>
          </div>
        </section>
      </div>

      <!-- Derecha: panel de filtros -->
<div class="col-12 col-lg-3 col-xl-2">
  <section class="panel bx-sticky-filters">
          <div class="panel-header">Filtrar por</div>
          <div class="panel-body">
            <div id="bxFiltersPanel" class="d-grid gap-2"></div>
          </div>
        </section>
      </div>
    </div>
  </main>


 
  <script src="./split/busquedax.bootstrap.js"></script>
  <script src="./split/busquedax.gr.js"></script>
  <script src="./split/busquedax.he.js"></script>
  <script src="./split/busquedax.es.js"></script>
  <script src="./split/busquedax.core.js"></script>
  <script src="./split/busquedax.filter.js"></script>
  <script src="./split/busquedax.main.js"></script>
  <script>
  document.getElementById('backToReader')?.addEventListener('click', () => {
let target = './index.html';
    try{
      const rawState = sessionStorage.getItem('lectorState');
      if(rawState){
        const state = JSON.parse(rawState);
        const refSearch = String(state?.lastReferenceSearch || '').trim();
        const book = String(state?.currentBookSlug || '').trim();
        const name = String(state?.currentBookName || '').trim();

        if(refSearch){
          const p = new URLSearchParams();
          if(book) p.set('book', book);
          if(name) p.set('name', name);
          p.set('search', refSearch);
          p.set('version', 'RVR1960');
          p.set('orig', '1');
          target = `./index.html?${p.toString()}`;
        }
      }
    }catch{}
    location.href = target;
  });

  (function(){
    const allowedThemes = new Set(['cream', 'white']);
    const stored = localStorage.getItem('lectorTheme');
    const theme = allowedThemes.has(stored) ? stored : 'cream';
    document.documentElement.dataset.theme = theme;
  })();
</script>
</body>
</html>
