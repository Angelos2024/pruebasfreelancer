<!doctype html>
<html lang="es" data-theme="cream">
<head>
  <meta charset="utf-8"/>
 <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Área de Análisis Textual</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
   :root{
      --bd:#e6e8eb;
      --muted:#6b7280;
      --bg:#f8fafc;
      --surface:#ffffff;
      --text:#0f172a;
      --primary:#2563eb;
      --primary-contrast:#ffffff;
      --soft-bg:#f1f5f9;
      --soft-hover:#e9eef5;
      --outline:#cbd5f5;
    }
    [data-theme="cream"]{
      --bd:#d5c1b1;
      --muted:#6d5d52;
      --bg:#edddce;
      --surface:#cdbaa9;
      --text:#2c1d1f;
      --primary:#4b2743;
      --primary-contrast:#fdf6f2;
      --soft-bg:#e0cdbd;
      --soft-hover:#d6c2b2;
      --outline:#4b2743;
    }
    [data-theme="white"]{
      --bd:#e6e8eb;
      --muted:#6b7280;
      --bg:#f8fafc;
      --surface:#ffffff;
      --text:#0f172a;
      --primary:#2563eb;
      --primary-contrast:#ffffff;
      --soft-bg:#f1f5f9;
      --soft-hover:#e9eef5;
      --outline:#cbd5f5;
    }
    body{ background:var(--bg); color:var(--text); }
    .topbar{
      background:#ffffff;
      border-bottom:1px solid var(--bd);
      position:sticky; top:0; z-index:1000;
    }
    .sitewrap{ max-width: 1280px; }
    .panel{
     background:var(--surface);
      border:1px solid var(--bd);
      border-radius:12px;
    }
    .panel-header{
      border-bottom:1px solid var(--bd);
      padding:.75rem 1rem;
      font-weight:600;
    }
   .panel-body{ padding:1rem; background:var(--surface); }
    .btn-soft{ background:var(--soft-bg); border:1px solid var(--bd); color:var(--text); }
    .btn-soft:hover{ background:var(--soft-hover); }
    .btn-primary{
      background:var(--primary);
      border-color:var(--primary);
      color:var(--primary-contrast);
    }
    .btn-outline-primary{
      color:var(--primary);
      border-color:var(--primary);
    }
    [data-theme="cream"] .btn-primary,
    [data-theme="cream"] .btn-outline-primary{
      background:#4b2743;
      border-color:#4b2743;
      color:#ffffff;
    }
    [data-theme="cream"] .btn-primary:hover,
    [data-theme="cream"] .btn-outline-primary:hover{
      background:#ffffff;
      border-color:#4b2743;
      color:#000000;
    }
    [data-theme="white"] .btn-primary,
    [data-theme="white"] .btn-outline-primary{
      background:#ffffff;
      border-color:#2563eb;
      color:#2563eb;
    }
    [data-theme="white"] .btn-primary:hover,
    [data-theme="white"] .btn-outline-primary:hover{
      background:#eff6ff;
      border-color:#2563eb;
      color:#1d4ed8;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.15rem .6rem;
      border-radius:999px;
      font-size:.8rem;
 background:var(--soft-bg);
      color:var(--text);
      border:1px solid var(--bd);
    }
    .muted{ color:var(--muted); }
    .lexicon-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:.75rem;
    }
    .example-card{
    border:1px dashed var(--outline);
      background:var(--soft-bg);
      border-radius:10px;
      padding:.65rem .75rem;
      font-size:.9rem;
    }
       [data-theme="cream"] .panel-header{
      border-bottom:1px solid #7c4f2b;
    }
    [data-theme="cream"] .panel-body{
      background:#ffffff;
      color:#000000;
    }
    [data-theme="cream"] .panel-body .muted{
      color:#000000;
    }
    [data-theme="cream"] .tag{
      background:#ffffff;
      color:#000000;
      border-color:#000000;
    }
    [data-theme="cream"] .example-card{
      background:#ffffff;
      color:#000000;
      border-color:#000000;
    }
    .greek{
      font-family: 'Gentium Plus','SBL Greek','Times New Roman',serif;
      font-size:1.05rem;
    }
    .hebrew{
      direction:rtl;
      unicode-bidi:plaintext;
      font-family: 'SBL Hebrew','Ezra SIL','Times New Roman',serif;
      font-size:1.08rem;
    }
     .search-row{
      display:grid;
      grid-template-columns:minmax(0, 1.28fr) minmax(320px, .82fr);
      gap:.65rem;
      align-items:stretch;
    }
    .search-column,
    .donut-column{
      display:flex;
      flex-direction:column;
      min-width:0;
    }
    #occurrenceDonutMount .occurrence-donut.card-like{
      margin-top:0;
      height:100%;
    }
 #occurrenceDonutMount .occurrence-donut-layout{
      grid-template-columns:minmax(150px, .8fr) minmax(145px, .92fr);
      gap:.5rem;
      align-items:start;
    }
    #occurrenceDonutMount .donut-svg{ width:clamp(132px, 15vw, 170px); height:clamp(132px, 15vw, 170px); }
    #occurrenceDonutMount .donut-total{ font-size:1.6rem; }
    #occurrenceDonutMount .legend-row{ font-size:.8rem; }
    .helper-list li{ margin-bottom:.35rem; }
    .loading-indicator{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      font-size:.85rem;
      color:var(--muted);
    }
    .loading-indicator .spinner{
      width:1rem;
      height:1rem;
      border:2px solid #cbd5f5;
      border-top-color:var(--primary);
      border-radius:50%;
      animation:spin .8s linear infinite;
    }
    .results-loading-stage{
      min-height:320px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:.85rem;
      color:var(--muted);
      background:color-mix(in srgb, var(--soft-bg) 55%, #ffffff);
      border:1px dashed var(--bd);
      border-radius:12px;
      margin-bottom:1rem;
    }
    .results-loading-stage .big-spinner{
      width:4.5rem;
      height:4.5rem;
      border:6px solid color-mix(in srgb, var(--primary) 20%, #ffffff);
      border-top-color:var(--primary);
      border-radius:50%;
      animation:spin .9s linear infinite;
    }
    [data-theme="cream"] .results-loading-stage{
      background:#ffffff;
      color:#000000;
      border-color:#4b2743;
    }
    .form-control,
    .form-select{
      background:#ffffff;
      border-color:color-mix(in srgb, var(--text) 55%, #ffffff);
      color:var(--text);
    }
    .form-control::placeholder{ color:color-mix(in srgb, var(--muted) 80%, transparent); }
    .analysis-title{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      text-align:center;
      line-height:1.2;
    }
    .occurrence-donut.card-like{
      border:1px solid var(--bd);
      border-radius:12px;
      padding:.75rem;
      background:#fff;
      margin-top:.75rem;
    }
    .occurrence-donut-layout{
      display:grid;
      grid-template-columns:minmax(230px, 1fr) minmax(180px, 1fr);
      gap:.75rem;
      align-items:center;
    }
    .donut-stage{ position:relative; display:grid; place-items:center; }
    .donut-svg{ width:220px; height:220px; }
    .donut-center{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      pointer-events:none;
    }
    .donut-total{ font-weight:700; font-size:2rem; line-height:1; }
    .donut-subtitle{
      font-size:.8rem;
      color:#1e293b;
      margin-top:.25rem;
      padding:.18rem .5rem;
      border-radius:999px;
      background:color-mix(in srgb, #ffffff 55%, #cbd5e1 45%);
      border:1px solid color-mix(in srgb, #64748b 28%, #ffffff);
      font-weight:600;
      box-shadow:0 1px 2px rgba(15, 23, 42, .14);
      max-width:86%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .donut-center [data-role="reset"]{ pointer-events:auto; }
    .donut-legend{ display:grid; gap:.45rem; align-content:start; }
    .legend-row{
      width:100%;
      border:1px solid var(--bd);
      border-radius:10px;
      background:#fff;
      display:flex;
      align-items:center;
      gap:.45rem;
      padding:.35rem .45rem;
      font-size:.86rem;
      text-align:left;
    }
    .legend-dot{ width:.7rem; height:.7rem; border-radius:50%; flex:0 0 .7rem; }
    .legend-label{ flex:1; }
    .legend-value{ font-weight:700; }
    @media (max-width: 767.98px){
      .analysis-title{
        position:static;
        transform:none;
        width:100%;
        margin-top:.5rem;
      }
    }
    @keyframes spin{
      to{ transform:rotate(360deg); }
    }
     /* Responsive tablet + desktop (celulares fuera de alcance) */
    :root{
      --layout-min-tablet: 768px;
    }

    @media (max-width: 767.98px){
      body{
        min-width: var(--layout-min-tablet);
        overflow-x:auto;
      }
      .container.sitewrap{
        min-width: var(--layout-min-tablet);
      }
    }

    @media (min-width: 768px) and (max-width: 1024px){
      .sitewrap{ max-width: 980px; }
      .panel-header{ padding:.65rem .85rem; }
      .panel-body{ padding:.85rem; }
      .search-row{ grid-template-columns:minmax(0, 1.1fr) minmax(300px, .9fr); }
      .occurrence-donut-layout{ grid-template-columns:1fr; }
    }

    @media (min-width: 1025px) and (max-width: 1366px){
      .sitewrap{ max-width: 1240px; }
    }

    @media (min-width: 1367px) and (max-width: 1920px){
      .sitewrap{ max-width: 1460px; }
    }

    @media (min-width: 1921px) and (max-width: 2499px){
      .sitewrap{ max-width: 1720px; }
      .panel-body{ padding:1.1rem 1.15rem; }
      .panel-header{ font-size:1.03rem; }
    }
     @media (min-width: 2500px){
      .sitewrap{ max-width: 2100px; }
      .topbar .btn,
      .topbar .form-control,
      .topbar .form-select{ font-size:1.05rem; }
      .panel-header{ padding:.9rem 1.2rem; font-size:1.08rem; }
      .panel-body{ padding:1.3rem; }
      .lexicon-grid{ grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
      .greek,
      .hebrew{ font-size:1.2rem; }
    }

    /* Estructura del resumen del lema y secciones contraíbles (solo este panel) */
    #lemmaSummaryPanel .lemma-summary-block{ display:flex; flex-direction:column; gap:.5rem; }
    #lemmaSummaryPanel .lemma-summary-block .summary-line{ display:block; margin-bottom:.25rem; }
    #lemmaSummaryPanel .lemma-summary-block .summary-line strong{ display:inline-block; min-width:10rem; color:var(--muted); font-weight:600; }
    #lemmaSummaryPanel details.lexicon-details{ margin-top:.5rem; border:1px solid var(--bd); border-radius:8px; overflow:hidden; }
    #lemmaSummaryPanel details.lexicon-details summary{ padding:.5rem .75rem; background:var(--soft-bg); cursor:pointer; font-weight:600; }
    #lemmaSummaryPanel details.lexicon-details[open] summary{ border-bottom:1px solid var(--bd); }
    #lemmaSummaryPanel details.lexicon-details .details-inner{ padding:.75rem; }
    #deepLexicalAnalysis details.analysis-details{ margin-bottom:.75rem; border:1px solid var(--bd); border-radius:8px; overflow:hidden; }
    #deepLexicalAnalysis details.analysis-details summary{ padding:.5rem .75rem; background:var(--soft-bg); cursor:pointer; font-weight:600; }
    #deepLexicalAnalysis details.analysis-details[open] summary{ border-bottom:1px solid var(--bd); }
    #deepLexicalAnalysis details.analysis-details .details-inner{ padding:.75rem; }
  </style>
</head>
<body>
  <header class="topbar">
  <div class="container sitewrap py-2 d-flex flex-wrap gap-2 align-items-center position-relative">
      <a class="btn btn-soft btn-sm" href="index.html">Volver al lector</a>
      <div class="analysis-title">
        <div class="fw-semibold">Área de análisis textual</div>
<div class="small muted">LXX · Hebreo · RKANT · RVR1960</div>
      </div>
    </div>
  </header>

  <main class="container sitewrap my-3 my-lg-4">
    <section class="panel mb-3">
      <div class="panel-header">Buscador y criterio</div>
      <div class="panel-body">
       <div class="search-row">
          <div class="search-column">
           <div class="search-controls">
              <div>
                <label for="queryInput" class="form-label fw-semibold">Buscar palabra o lema</label>
                <div class="input-group">
                  <input id="queryInput" class="form-control" placeholder="Ej: אָב, πατήρ, origen, fuente" value="πατήρ"/>
                 <button id="analyzeBtn" class="btn btn-primary" type="button">Analizar</button>
                </div>
                <div class="form-text">Se aceptan términos de una sola palabra en hebreo, griego o español.</div>  
              </div>
              <div>
                <label class="form-label fw-semibold">Filtros rápidos</label>
                <div class="d-flex flex-wrap gap-2">
                  <button class="btn btn-soft btn-sm" type="button" data-filter="torah">Torah</button>
                  <button class="btn btn-soft btn-sm" type="button" data-filter="profetas">Profetas</button>
                  <button class="btn btn-soft btn-sm" type="button" data-filter="evangelios">Evangelios</button>
                  <button class="btn btn-soft btn-sm" type="button" data-filter="cartas">Cartas</button>
                  <button class="btn btn-soft btn-sm" type="button" data-filter="todo">Todo</button>
                </div>
              </div>
            </div>
            <div class="form-text">Los filtros ajustan los resultados por corpus según el idioma detectado.</div>
          </div>
         <div class="donut-column" id="occurrenceDonutMount"></div>
       </div>
      </div>
    </section>

    <div id="analysisResultsSection" class="row g-3">
      <div class="col-12 col-lg-4">
<section id="lemmaSummaryPanel" class="panel h-100">
  <div class="panel-header">Resumen del lema</div>
          <div class="panel-body">
            <div class="d-flex flex-column gap-2">
              <details class="lexicon-details" open>
                <summary>Etiquetas y datos del diccionario</summary>
                <div class="details-inner">
                  <div id="lemmaTags" class="d-flex flex-wrap gap-2"></div>
                </div>
              </details>
              <details class="lexicon-details" open>
                <summary>Lema, significado y análisis léxico</summary>
                <div class="details-inner">
                  <p id="lemmaSummary" class="lemma-summary-placeholder small muted mb-0">Escribe un término para generar el resumen del lema.</p>
                </div>
              </details>
              <details class="lexicon-details" open>
                <summary>Correspondencia multilingüe</summary>
                <div class="details-inner">
                  <div id="lemmaCorrespondence" class="d-grid gap-2"></div>
                </div>
              </details>
              <details class="lexicon-details" open>
                <summary>Ejemplos en contexto</summary>
                <div class="details-inner">
                  <div id="lemmaExamples" class="d-grid gap-2"></div>
                </div>
              </details>
            </div>
          </div>
        </section>
      </div>

      <div class="col-12 col-lg-8">
        <section class="panel">
         <div class="panel-header d-flex flex-wrap justify-content-between align-items-center gap-2">
            <span>Análisis Léxico</span>
           <div id="resultsLoadingIndicator" class="loading-indicator" role="status" aria-live="polite" hidden>
              <span class="spinner" aria-hidden="true"></span>
            <span>Construyendo análisis léxico...</span>
           </div>
          </div>
          <div class="panel-body">
             <div id="resultsLoadingStage" class="results-loading-stage" role="status" aria-live="polite" hidden>
              <span class="big-spinner" aria-hidden="true"></span>
              <span class="fw-semibold">Cargando análisis...</span>
            </div>
            <div id="deepLexicalAnalysis" class="row g-3"></div>
          </div>
        </section>
      </div>
    </div>
  </main>
    <script src="./analisis-donut.js"></script>
  <script src="./analisis.js"></script>
  <script>
    (function(){
      const allowedThemes = new Set(['cream', 'white']);
      const stored = localStorage.getItem('lectorTheme');
      const theme = allowedThemes.has(stored) ? stored : 'cream';
      document.documentElement.dataset.theme = theme;
    })();
  </script>
</body>
</html>
